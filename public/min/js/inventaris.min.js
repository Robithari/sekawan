const axios=require("axios"),db=require("../config/firebase");function formatTanggal(a){const r=a.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);if(r)return`${r[1]}-${r[2]}-${r[3]}`;const t=new Date(a);if(isNaN(t.getTime()))return"Tanggal tidak valid";return`${("0"+t.getDate()).slice(-2)}-${("0"+(t.getMonth()+1)).slice(-2)}-${t.getFullYear()}`}async function getInventarisData(){try{const a=await axios.get("https://script.googleusercontent.com/macros/echo?user_content_key=Yqyq1DhrzBe_pzk0D3UUfGB_sKx2T2TqV2XJYhejgo3WXzBw1IYswWdHQJoyct88kBU6CF9RVRuC3MwlKp4sM9lzXBxDc42dm5_BxDlH2jW0nuo2oDemN9CCS2h10ox_1xSncGQajx_ryfhECjZEnLGVgPpKtvYPUnnNghbhLesi3kyGTxNlq-mqqu6k0bRGx0g3iP6Nsd77ABz2ja6HbwgMdF1gKSmKbkF-zXBdD6hz3abTnINGdA&lib=MRZfPoZa3sDHpg9sMQ6l5IA3C713IOBJS"),r=a.data["BARANG-INVENTARIS"]||[];return Array.isArray(r)?(r.forEach(a=>{a.NAMA_BARANG=a["JENIS BARANG"]||"-",a.MERK_BARANG=a["MERK BARANG"]||"-",a.JUMLAH=a["JUMLAH BARANG"]||"-",a.KODE=a["KODE BARANG"]||"-",a.KONDISI_BAIK=a["JUMLAH KONDISI BARANG BAIK"]||"-",a.KONDISI_BURUK=a["JUMLAH KONDISI BARANG BURUK"]||"-",a.KETERANGAN=a.KETERANGAN||"-",a.TANGGAL&&(a.TANGGAL=formatTanggal(a.TANGGAL))}),r):(console.log("Data inventaris bukan array, memformat data menjadi array."),[r])}catch(a){throw console.error("Error mengambil data inventaris:",a),new Error("Error mengambil data inventaris")}}async function getFooterData(){try{const a=await db.collection("footer").get();return a.docs.map(a=>a.data())[0]||{}}catch(a){throw console.error("Error mengambil data footer:",a),new Error("Error mengambil data footer")}}async function renderInventarisPage(a,r){try{const a=await getInventarisData(),t=await getFooterData();r.render("inventaris",{inventarisData:a,footerData:t})}catch(a){r.status(500).send("Terjadi kesalahan pada server")}}module.exports={renderInventarisPage:renderInventarisPage};