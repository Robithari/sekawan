import{getFirestore,collection,getDocs,deleteDoc,updateDoc,doc,query,getDoc}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";import{initializeApp,getApps}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";import*as firebaseConfig from"../../firebase-config.js";let app;app=getApps().length?getApps()[0]:initializeApp(firebaseConfig);const db=getFirestore(app),pertandinganCollectionRef=collection(db,"jadwalPertandingan"),pertandinganSelection=document.getElementById("pertandingan-selection"),updateBtn=document.getElementById("pertandingan-update-btn"),cancelBtn=document.getElementById("pertandingan-cancel-btn"),message=document.getElementById("pertandingan-message"),addPertandinganForm=document.getElementById("addPertandinganForm");let currentPertandinganId=null;function displayMessage(e,n="info"){message.textContent=e,message.className=`alert alert-${n}`,message.classList.remove("d-none"),setTimeout(()=>message.classList.add("d-none"),5e3)}async function handleFormSubmit(e){e.preventDefault();const n={timKita:document.getElementById("timA").value,vs:"vs",timLawan:document.getElementById("timB").value,hari:document.getElementById("hari").value,tanggal:new Date(document.getElementById("tanggalPertandingan").value).toISOString(),waktu:document.getElementById("waktu").value};currentPertandinganId&&(await updatePertandingan(currentPertandinganId,n),resetForm())}function resetForm(){addPertandinganForm.reset(),currentPertandinganId=null,updateBtn.classList.add("d-none"),cancelBtn.classList.add("d-none"),document.getElementById("form-title-pertandingan").innerText="Edit Jadwal Pertandingan",addPertandinganForm.style.display="none"}async function fetchPertandingan(){pertandinganSelection.innerHTML="";try{const e=await getDocs(pertandinganCollectionRef);if(e.empty)return void(pertandinganSelection.innerHTML="<p>Tidak ada jadwal pertandingan yang tersedia.</p>");e.forEach(e=>{const n=e.data();pertandinganSelection.innerHTML+=generatePertandinganCard(e.id,n)}),attachEventListeners()}catch(e){console.error("Error saat memuat daftar pertandingan:",e),displayMessage(`Gagal memuat pertandingan: ${e.message}`,"danger")}}function generatePertandinganCard(e,n){return`\n        <div class="col-md-4 mb-4">\n            <div class="card h-100">\n                <div class="card-body">\n                    <h5 class="card-title">${n.timKita} ${n.vs} ${n.timLawan}</h5>\n                    <p class="card-text text-muted">${n.hari}, ${new Date(n.tanggal).toLocaleDateString("id-ID")} Pukul ${n.waktu}</p>\n                    <div class="mt-auto">\n                        <button class="btn btn-warning edit-btn mt-2" data-id="${e}">Edit</button>\n                    </div>\n                </div>\n            </div>\n        </div>`}async function updatePertandingan(e,n){try{const t=doc(db,"jadwalPertandingan",e);await updateDoc(t,n),displayMessage("Pertandingan berhasil diperbarui!","success"),fetchPertandingan()}catch(e){displayMessage(`Gagal memperbarui pertandingan: ${e.message}`,"danger")}}async function editPertandinganById(e){try{const n=await getDoc(doc(db,"jadwalPertandingan",e));if(!n.exists())throw new Error("Pertandingan tidak ditemukan.");populateForm(n.data()),currentPertandinganId=e,updateBtn.classList.remove("d-none"),cancelBtn.classList.remove("d-none"),document.getElementById("form-title-pertandingan").innerText="Edit Jadwal Pertandingan",addPertandinganForm.style.display="block",window.scrollTo({top:0,behavior:"smooth"})}catch(e){displayMessage(`Gagal memuat pertandingan: ${e.message}`,"danger")}}function populateForm(e){document.getElementById("timA").value=e.timKita,document.getElementById("timB").value=e.timLawan,document.getElementById("hari").value=e.hari,document.getElementById("tanggalPertandingan").value=new Date(e.tanggal).toISOString().split("T")[0],document.getElementById("waktu").value=e.waktu}function attachEventListeners(){document.querySelectorAll(".edit-btn").forEach(e=>{e.addEventListener("click",()=>editPertandinganById(e.dataset.id))})}addPertandinganForm.style.display="none",addPertandinganForm.addEventListener("submit",handleFormSubmit),cancelBtn.addEventListener("click",resetForm),document.addEventListener("DOMContentLoaded",fetchPertandingan);