import{collection,addDoc,getDocs,deleteDoc,doc}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";import{getStorage,ref,uploadBytes,getDownloadURL}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";import{db}from"../../firebase-config.js";import{getAuth}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";const storage=getStorage(),auth=getAuth();export async function loadCarouselContents(){try{const e=await getDocs(collection(db,"carousel")),t=document.getElementById("carousel-selection");t.innerHTML="",e.forEach(e=>{const o=e.data().imageUrl,a=`\n                <div class="carousel-item-admin" data-id="${e.id}">\n                    <img src="${o}" alt="Carousel Image" class="img-thumbnail" style="max-width: 150px;">\n                    <button class="btn btn-danger btn-sm delete-btn">Hapus</button>\n                </div>\n            `;t.innerHTML+=a}),document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",async function(e){const t=e.target.closest(".carousel-item-admin").getAttribute("data-id");await deleteCarouselImage(t)})})}catch(e){console.error("Error loading carousel contents:",e)}}export async function addCarouselImage(e){e.preventDefault();const t=document.getElementById("fileInput").files[0];if(!t)return void alert("Mohon pilih gambar untuk diunggah.");if(auth.currentUser)try{const e=ref(storage,"carousel/"+t.name);await uploadBytes(e,t);const o=await getDownloadURL(e);await addDoc(collection(db,"carousel"),{imageUrl:o}),document.getElementById("carouselForm").reset(),loadCarouselContents()}catch(e){console.error("Error adding carousel image:",e)}else alert("Anda perlu login untuk mengupload gambar.")}export async function deleteCarouselImage(e){try{await deleteDoc(doc(db,"carousel",e)),loadCarouselContents()}catch(e){console.error("Error deleting carousel image:",e)}}window.addEventListener("DOMContentLoaded",function(){loadCarouselContents();const e=document.getElementById("carouselForm");e&&e.addEventListener("submit",addCarouselImage)});