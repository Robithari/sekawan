import{initializeApp}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";import{getAuth,signInWithEmailAndPassword,createUserWithEmailAndPassword,sendPasswordResetEmail}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";import{getFirestore,collection,query,where,getDocs,setDoc,doc}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";import{db}from"../firebase-config.js";const auth=getAuth(),forgotPasswordLink=document.getElementById("forgotPasswordLink"),loginContainer=document.getElementById("login-container"),signupContainer=document.getElementById("signup-container"),goToSignup=document.getElementById("goToSignup"),goToLogin=document.getElementById("goToLogin");goToSignup.addEventListener("click",()=>{loginContainer.classList.add("d-none"),signupContainer.classList.remove("d-none")}),goToLogin.addEventListener("click",()=>{signupContainer.classList.add("d-none"),loginContainer.classList.remove("d-none")});const loginForm=document.getElementById("loginForm");loginForm.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("loginEmail").value,a=document.getElementById("loginPassword").value;try{const e=query(collection(db,"DataAdmin"),where("email","==",t));if((await getDocs(e)).empty)alert("Login ditolak. Anda bukan admin.");else{const e=(await signInWithEmailAndPassword(auth,t,a)).user,n=await e.getIdToken();document.cookie=`__session=${n}; path=/; max-age=3600; secure; samesite=strict`,alert("Login sukses!"),window.location.href="/cms"}}catch(e){alert("Login gagal: "+e.message)}});const signupForm=document.getElementById("signupForm");signupForm.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("signupName").value,a=document.getElementById("signupEmail").value,n=document.getElementById("signupPassword").value,i=document.getElementById("adminCode").value;try{const e=query(collection(db,"adminCodes"),where("code","==",i));if((await getDocs(e)).empty)alert("Kode admin tidak valid.");else{const e=(await createUserWithEmailAndPassword(auth,a,n)).user;await setDoc(doc(db,"DataAdmin",e.uid),{name:t,email:a,adminCode:i}),alert("Sign up sukses! Selamat datang di Sekawan FC"),window.location.href="/cms"}}catch(e){alert("Sign up gagal: "+e.message)}}),forgotPasswordLink.addEventListener("click",async()=>{const e=prompt("Masukkan email Anda untuk reset password:");if(e)try{const t=query(collection(db,"DataAdmin"),where("email","==",e));(await getDocs(t)).empty?alert("Email tidak terdaftar."):(await sendPasswordResetEmail(auth,e),alert("Link reset password telah dikirim ke email Anda!"))}catch(e){alert("Gagal mengirim email reset password: "+e.message)}});