<!DOCTYPE html>
<html lang="en" translate="no">

<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CD0MHD1RBP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());
        gtag('config', 'G-CD0MHD1RBP');
    </script>

    <!-- link preview -->
    <meta property="og:title" content="Kas Sekawan FC" />
    <meta property="og:description" content="Laporan Kas Sekawan FC Realtime" />
    <meta property="og:image" content="https://sekawanfc.fun/img/kas-sekawan-fc.jpg" />
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <!-- link preview -->

    <!-- Cache Control -->
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="-5">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <!-- Viewport and Meta -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="google" content="notranslate">

    <!-- Bootstrap and Styles -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/loading.css">
    <link rel="stylesheet" href="css/kas.css">

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="icon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="icon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="icon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="icon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="icon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="icon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon/favicon-16x16.png">
    <link rel="manifest" href="manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="icon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">


    <title>Kas-Sekawan FC</title>
</head>

<body>
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
    </div>
    <!-- END Loading Spinner -->
    <div class="mobile-only">
        <div class="content-wrapper">
            <div class="wrapper">

                <!-- Navbar -->
                <nav class="navbar navbar-expand-lg custom-navbar">
                    <div class="container-fluid">
                        <a class="navbar-brand text-white fw-bold" href="/">
                            <div class="d-flex align-items-center">
                                <img src="/img/SekawanFC.jpg" alt="Sekawan FC Logo" class="icon-img" width="40"
                                    height="40">
                                <span class="ms-2">SEKAWAN FC</span>
                            </div>
                        </a>
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                                <li class="nav-item">
                                    <a class="nav-link text-white" aria-current="page" href="/">Home</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link text-white" href="/profil">Profil</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle text-white" href="#" role="button"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                        Informasi
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item text-blue" href="/rangkuman-berita">Berita</a>
                                        </li>
                                        <li><a class="dropdown-item text-blue" href="/rangkuman-artikel">Artikel</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link text-white" id="login-logout-link" href="/login">Masuk /
                                        Daftar</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
                <!-- End Navbar -->

                <!-- Data Kas -->
                <div class="container-kas">
                    <h5>DATA KAS</h5>
                    <form class="row g-2 mb-3 align-items-end" id="formCariKas" method="get" action="/kas" autocomplete="off">
                        <div class="col-md-3 col-7">
                            <input type="text" class="form-control" name="kode" id="inputKodeKas" placeholder="Cari kode/invoice kas..."
                                value="<%= kodeCari && kodeCari.length > 0 ? kodeCari : '' %>">
                        </div>
                        <div class="col-md-2 col-5 d-flex gap-2">
                            <button type="submit" class="btn btn-primary w-100" id="btnCariKas">Cari</button>
                            <% if (kodeCari && kodeCari.length > 0) { %>
                                <button type="button" class="btn btn-success w-100" id="btnSelesaiKas">Selesai</button>
                            <% } %>
                        </div>
                    </form>
                    <% 
                        let saldo = 0;
                        let filtered = kasData;
                        if (typeof kodeCari !== 'undefined' && kodeCari) {
                            filtered = kasData.filter(kas => kas.kode && kas.kode.toLowerCase().includes(kodeCari.toLowerCase()));
                        }
                        filtered.sort((a, b) => {
                            const ta = a.tanggal && a.tanggal._seconds ? a.tanggal._seconds : 0;
                            const tb = b.tanggal && b.tanggal._seconds ? b.tanggal._seconds : 0;
                            return tb - ta;
                        });
                    %>
                    <div id="notifEditKas" class="mb-2"></div>
                    <!-- Tidak ada form edit kas di halaman /kas, hanya tombol selesai pencarian yang aktif -->
                    <div class="table-container">
                        <table id="data-table">
                            <thead>
                                <tr>
                                    <th>TANGGAL</th>
                                    <th>KODE</th>
                                    <th>KETERANGAN</th>
                                    <th>PEMASUKAN</th>
                                    <th>PENGELUARAN</th>
                                    <th>SALDO/SISA</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% saldo = 0; // reset saldo untuk tabel, jangan deklarasi ulang let saldo %>
                                <% if (filtered.length === 0 && kodeCari && kodeCari.length > 0) { %>
                                    <tr>
                                        <td colspan="6" class="text-center text-danger">Kode yang anda input tidak tersedia</td>
                                    </tr>
                                <% } else { 
                                    filtered.forEach((kas, index) => {
                                        let pemasukan = (kas.jenis === 'masuk') ? kas.nominal : 0;
                                        let pengeluaran = (kas.jenis === 'keluar') ? kas.nominal : 0;
                                        saldo += pemasukan - pengeluaran;
                                %>
                                    <tr class="<%= index % 2 === 0 ? 'gray-background' : '' %>">
                                        <td>
                                            <% if (kas.tanggal && kas.tanggal._seconds) { %>
                                                <%= new Date(kas.tanggal._seconds * 1000).toLocaleDateString('id-ID') %>
                                            <% } else { %>
                                                <%= kas.tanggal || '-' %>
                                            <% } %>
                                        </td>
                                        <td><%= kas.kode || '-' %></td>
                                        <td><%= kas.keterangan %></td>
                                        <td class="text-end"><%= pemasukan ? 'Rp. ' + pemasukan.toLocaleString('id-ID') : '-' %>
                                        </td>
                                        <td class="text-end"><%= pengeluaran ? 'Rp. ' + pengeluaran.toLocaleString('id-ID') : '-' %>
                                        </td>
                                        <td class="text-end"><%= 'Rp. ' + saldo.toLocaleString('id-ID') %></td>
                                    </tr>
                                <% }); 
                                    } %>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- End Data Kas -->

                <!-- Footer -->
                <footer class="custom-footer">
                    <div class="footer-content">
                        <div class="footer-section">
                            <h6>Ikuti Kami</h6>
                            <div class="social-icons">
                                <a href="#" class="social-icon" target="_blank" id="facebook-link"
                                    aria-label="Facebook">
                                    <img src="https://w7.pngwing.com/pngs/670/159/png-transparent-facebook-logo-social-media-facebook-computer-icons-linkedin-logo-facebook-icon-media-internet-facebook-icon.png"
                                        alt="Ikon Facebook" class="icon-image">
                                </a>
                                <a href="#" class="social-icon" target="_blank" id="instagram-link"
                                    aria-label="Instagram">
                                    <img src="https://cdn.pixabay.com/photo/2016/08/09/17/52/instagram-1581266_1280.jpg"
                                        alt="Ikon Instagram" class="icon-image">
                                </a>
                            </div>
                        </div>
                        <div class="footer-section">
                            <h6>Hubungi Kami</h6>
                            <p class="footer-email">Email: <a class="footer-email-link"
                                    href="mailto:<%= footerData.email %>" id="email-link">
                                    <%= footerData.email %>
                                </a></p>
                            <p class="footer-telephone">Telepon: <span id="telephone">
                                    <%= footerData.telephone %>
                                </span></p>
                        </div>

                    </div>
                    <div class="footer-bottom">
                        <p class="footer-bottom-copyright">Copyright &copy; 2024 SekawanFC, All rights reserved</p>
                        <p class="footer-bottom-dibuat">Dibuat oleh BithDev</p>
                    </div>
                </footer>
                <!-- END Footer -->
            </div>
            <!-- SCRIPTS -->
            <div class="container-js">
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
                    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
                    crossorigin="anonymous"></script>
                <script src="js/pencarian.js"></script>
                <script src="js/hapus-cookie.js"></script>
                <script src="js/cek-login.js" defer></script>
                <script src="js/kunci-layar.js"></script>
                <script type="module" src="firebase-config.js"></script>
                <script src="js/loading.js"></script>
                <script src="js/edit-kas.js"></script>
                <!-- <script src="js/cek-auth.js" defer></script> -->
            </div>
            <!-- END SCRIPTS -->

            <!-- Service Worker -->
            <script>
                if ('serviceWorker' in navigator) {
                    window.addEventListener('load', function () {
                        navigator.serviceWorker.register('/service-worker.js').then(function (registration) {
                            console.log('Service Worker registered with scope:', registration.scope);
                        }, function (error) {
                            console.error('Service Worker registration failed:', error);
                        });
                    });
                }
            </script>
            <!-- END Service Worker -->
        </div>
    </div>
    <script>
        // Interaktif: tombol Selesai mengembalikan data penuh tanpa reload
        const btnSelesai = document.getElementById('btnSelesaiKas');
        if (btnSelesai) {
            btnSelesai.addEventListener('click', function() {
                document.getElementById('inputKodeKas').value = '';
                document.getElementById('formCariKas').submit();
            });
        }
    </script>
</body>

</html>